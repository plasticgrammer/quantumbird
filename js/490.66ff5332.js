"use strict";(self["webpackChunkweekly_report"]=self["webpackChunkweekly_report"]||[]).push([[490],{3490:function(e,t,a){a.r(t),a.d(t,{default:function(){return F}});var o=a(689),l=a(2471),c=a(1059),i=a(3704),n=a(9244),r=a(3725),s=a(3960),d=a(6051),m=a(9494),u=a(8703),k=a(1689),v=a(9015),p=a(7424),g=a(3374),x=a(3630);const y={key:0},f={key:1},h={key:1,class:"ticket-chip-container"},w={class:"text-caption ml-1"},V={key:0},b={class:"text-caption text-grey-darken-1 mb-2"},N={class:"text-advice text-grey-darken-3"},C={key:0},B={key:0,class:"my-4"},E={key:1,class:"text-caption my-2"},_={key:1},T={class:"advisor-image-container d-flex align-end justify-center"},A={class:"text-button"},R={class:"d-flex justify-center mb-2"},S={key:1,class:"d-flex flex-column"},j={class:"d-flex align-center"},L={class:"text-caption pt-1"},O={key:1,class:"text-caption text-error my-1"};var D={__name:"ReportCompleteDialog",props:{modelValue:{type:Boolean,required:!0},reportContent:{type:Object,default:()=>({})},isAdviceEnabled:{type:Boolean,default:!1},enabledAdvisors:{type:Array,default:()=>[]}},emits:["update:modelValue","back","close"],setup(e,{emit:t}){const{isMobile:a}=(0,l.Q)(),D=e,M=t,z=(0,o.reactive)({selectedRole:"manager",isButtonHovering:!1,isLoading:!1,isAdviceAvailable:!1,isNewReport:!1,advice:"",remainingTickets:0,showAddTicetMessage:!1}),F=(0,o.computed)((()=>D.isAdviceEnabled&&D.enabledAdvisors?.length>0?Object.fromEntries(Object.entries(c._4).filter((([e])=>D.enabledAdvisors.includes(e)))):{manager:c._4.manager})),P=()=>{const e=Object.keys(F.value)[0]||"manager";Object.assign(z,{selectedRole:e,isButtonHovering:!1,isLoading:!1,isAdviceAvailable:!1,advice:"",showAddTicetMessage:!1})},U=async e=>{if(e&&D.isAdviceEnabled)try{const t=await(0,i.Xf)(e);z.remainingTickets=t.adviceTickets??0}catch(t){z.remainingTickets=0}},I=e=>{M("update:modelValue",e),e||P()},H=e=>{z.isButtonHovering=e},X=async()=>{if(!(z.isLoading||z.remainingTickets<=0))try{z.isLoading=!0;const e=await(0,c.Wx)(D.reportContent.memberUuid,D.reportContent.weekString,z.selectedRole);Object.assign(z,{advice:e.advice,remainingTickets:e.remainingTickets,isAdviceAvailable:!0})}catch(e){const t="INSUFFICIENT_TICKETS"===e.code,a=t?"アドバイスチケットが不足しています。新しい週次報告時に再度利用可能になります。":"申し訳ありません。アドバイスの生成中にエラーが発生しました。";t&&(z.remainingTickets=0),Object.assign(z,{advice:a,isAdviceAvailable:!0})}finally{z.isLoading=!1}},J=(0,o.computed)((()=>Object.keys(F.value))),Q=e=>{if(!D.modelValue||z.isAdviceAvailable)return;const t=J.value.indexOf(z.selectedRole);if("ArrowLeft"===e.key){const e=t<=0?J.value.length-1:t-1;z.selectedRole=J.value[e]}else if("ArrowRight"===e.key){const e=t>=J.value.length-1?0:t+1;z.selectedRole=J.value[e]}},W=()=>{Object.values(F.value).forEach((e=>{const t=new Image;t.src=e.image}))};return(0,o.onMounted)((()=>{window.addEventListener("keydown",Q),W()})),(0,o.onUnmounted)((()=>{window.removeEventListener("keydown",Q)})),(0,o.watch)((()=>D.reportContent),(async e=>{e?.memberUuid&&(P(),D.isAdviceEnabled&&(z.showAddTicetMessage=e.isNew,await U(e.memberUuid)))}),{immediate:!0}),(t,l)=>((0,o.openBlock)(),(0,o.createBlock)(d.p,{"model-value":e.modelValue,"max-width":e.isAdviceEnabled?z.isAdviceAvailable?780:600:480,persistent:"","onUpdate:modelValue":I},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r.Jn,{class:"bg-plain text-center rounded-lg d-flex flex-column"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r.ri,{class:"text-h5 font-weight-bold flex-shrink-0"},{default:(0,o.withCtx)((()=>[(0,o.unref)(a)?((0,o.openBlock)(),(0,o.createElementBlock)("span",y,"報告完了")):((0,o.openBlock)(),(0,o.createElementBlock)("span",f,"週次報告ありがとうございました"))])),_:1}),!(0,o.unref)(a)&&z.showAddTicetMessage?((0,o.openBlock)(),(0,o.createBlock)(r.ZR,{key:0},{default:(0,o.withCtx)((()=>l[5]||(l[5]=[(0,o.createTextVNode)(" 新しい週次報告によりアドバイスチケットが付与されました ")]))),_:1})):(0,o.createCommentVNode)("",!0),e.isAdviceEnabled?((0,o.openBlock)(),(0,o.createElementBlock)("div",h,[(0,o.createVNode)(s.x,{color:z.remainingTickets?"grey-darken-2":"grey-lighten-1",class:"ticket-chip",variant:"outlined"},{default:(0,o.withCtx)((()=>[z.remainingTickets<=3?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:0},(0,o.renderList)(3,(e=>(0,o.createVNode)(u.wP,{key:e,color:e<=z.remainingTickets?"primary":"grey-lighten-1",class:"ticket-icon",size:"small"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e<=z.remainingTickets?"mdi-ticket":"mdi-ticket-outline"),1)])),_:2},1032,["color"]))),64)):((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:1},[(0,o.createVNode)(u.wP,{class:"ticket-icon",size:"small",color:"indigo"},{default:(0,o.withCtx)((()=>l[6]||(l[6]=[(0,o.createTextVNode)("mdi-ticket")]))),_:1}),(0,o.createElementVNode)("span",w,(0,o.toDisplayString)(z.remainingTickets),1)],64)),(0,o.createVNode)(g.y,{activator:"parent",location:"bottom"},{default:(0,o.withCtx)((()=>l[7]||(l[7]=[(0,o.createTextVNode)(" アドバイスチケット残数 ")]))),_:1})])),_:1},8,["color"])])):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(r.OQ,{class:"py-1 flex-grow-1 scrollable-content"},{default:(0,o.withCtx)((()=>[e.isAdviceEnabled?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:0},[z.isAdviceAvailable?((0,o.openBlock)(),(0,o.createElementBlock)("div",V,[(0,o.createVNode)(p.i,{class:"text-left pa-4 pt-1 mx-3 rounded-lg advisor-container"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(k.y,{src:(0,o.unref)(c._4)[z.selectedRole].image,"max-width":"100",class:"mx-auto mt-0 mb-2","aspect-ratio":1},null,8,["src"]),(0,o.createElementVNode)("p",b,[(0,o.createVNode)(u.wP,{icon:(0,o.unref)(c._4)[z.selectedRole].icon,color:(0,o.unref)(c._4)[z.selectedRole].color,class:"me-1"},null,8,["icon","color"]),(0,o.createTextVNode)(" "+(0,o.toDisplayString)((0,o.unref)(c._4)[z.selectedRole].title)+"からのアドバイス ",1)]),(0,o.createElementVNode)("p",N,(0,o.toDisplayString)(z.advice),1)])),_:1}),Object.keys(F.value).length>1?((0,o.openBlock)(),(0,o.createElementBlock)("div",C,[z.remainingTickets>0?((0,o.openBlock)(),(0,o.createElementBlock)("div",B,[(0,o.createVNode)(n.D,{variant:"outlined",color:"grey-darken-2",onClick:P},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(u.wP,{icon:"mdi-swap-horizontal-bold",class:"mr-1"}),l[8]||(l[8]=(0,o.createTextVNode)(" 別のアドバイザーに相談する "))])),_:1})])):((0,o.openBlock)(),(0,o.createElementBlock)("p",E," アドバイスチケットを使い切りました。新しい週次報告時に再度利用可能になります。 "))])):(0,o.createCommentVNode)("",!0)])):((0,o.openBlock)(),(0,o.createElementBlock)("div",_,[(0,o.createVNode)(p.i,{class:"mx-3 py-3 rounded-lg advisor-container"},{default:(0,o.withCtx)((()=>[l[15]||(l[15]=(0,o.createElementVNode)("p",{class:"text-body-1"},"アドバイザーを選んでください",-1)),(0,o.createVNode)(x.r,{modelValue:z.selectedRole,"onUpdate:modelValue":l[0]||(l[0]=e=>z.selectedRole=e),"show-arrows":Object.keys(F.value).length>1,continuous:""},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(F.value,((e,t)=>((0,o.openBlock)(),(0,o.createBlock)(x.m,{key:t,value:t},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r.Jn,{class:"mx-2 bg-transparent",elevation:"0"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",T,[(0,o.createVNode)(k.y,{src:e.image,"max-width":"160",class:(0,o.normalizeClass)(["advisor-image mb-2 mx-auto",{"scale-up":z.isButtonHovering||z.isLoading}]),position:"top"},null,8,["src","class"])]),(0,o.createVNode)(r.ri,{class:"font-weight-bold"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(u.wP,{icon:e.icon,color:e.color,class:"mt-n1 me-2"},null,8,["icon","color"]),(0,o.createTextVNode)(" "+(0,o.toDisplayString)(e.title)+" ",1),(0,o.createElementVNode)("div",A,(0,o.toDisplayString)(e.description),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue","show-arrows"]),(0,o.createElementVNode)("div",R,[z.remainingTickets>0?((0,o.openBlock)(),(0,o.createBlock)(n.D,{key:0,class:"px-8 border-thin","min-width":"50%",height:"60px",variant:"outlined",style:{"--v-border-color":"auto"},disabled:0===z.remainingTickets,onMouseenter:l[1]||(l[1]=e=>H(!0)),onMouseleave:l[2]||(l[2]=e=>H(!1)),onClick:X},{default:(0,o.withCtx)((()=>[z.isLoading?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:0},[(0,o.createVNode)(v.x,{indeterminate:"",size:"22",width:"4",color:(0,o.unref)(c._4)[z.selectedRole].color,class:"me-2"},null,8,["color"]),l[9]||(l[9]=(0,o.createTextVNode)(" アドバイザーに相談中... "))],64)):((0,o.openBlock)(),(0,o.createElementBlock)("div",S,[(0,o.createElementVNode)("div",j,[(0,o.createVNode)(u.wP,{icon:"mdi-comment-text-outline",size:"large",class:"me-2"}),l[10]||(l[10]=(0,o.createElementVNode)("span",null,"このアドバイザーに相談する",-1))]),(0,o.createElementVNode)("div",L,[l[12]||(l[12]=(0,o.createTextVNode)(" （")),(0,o.createVNode)(u.wP,{size:"small",class:"mx-1"},{default:(0,o.withCtx)((()=>l[11]||(l[11]=[(0,o.createTextVNode)("mdi-ticket")]))),_:1}),l[13]||(l[13]=(0,o.createTextVNode)("チケットを1枚消費します） "))])]))])),_:1},8,["disabled"])):((0,o.openBlock)(),(0,o.createElementBlock)("p",O,l[14]||(l[14]=[(0,o.createTextVNode)(" アドバイスチケットを使い切りました。"),(0,o.createElementVNode)("br",null,null,-1),(0,o.createTextVNode)(" 新しい週次報告時に再度利用可能になります。 ")])))])])),_:1})]))],64)):((0,o.openBlock)(),(0,o.createBlock)(k.y,{key:1,src:(0,o.unref)(c._4)[z.selectedRole].image,"max-width":"200",class:"mx-auto mt-0 mb-3","aspect-ratio":1},null,8,["src"]))])),_:1}),(0,o.createVNode)(r.SL,{class:"pt-4 pb-4 flex-shrink-0"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m.Li,{justify:"center","no-gutters":""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m.B6,{cols:"auto",class:"mx-2"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n.D,{color:"primary","prepend-icon":"mdi-chevron-left",variant:"tonal",class:"border-thin",style:{"--v-border-color":"auto"},onClick:l[3]||(l[3]=e=>t.$emit("back"))},{default:(0,o.withCtx)((()=>l[16]||(l[16]=[(0,o.createTextVNode)(" 週次報告に戻る ")]))),_:1})])),_:1}),(0,o.createVNode)(m.B6,{cols:"auto",class:"mx-2"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n.D,{color:"grey-darken-1","prepend-icon":"mdi-close",variant:"tonal",class:"border-thin",style:{"--v-border-color":"auto"},onClick:l[4]||(l[4]=e=>t.$emit("close"))},{default:(0,o.withCtx)((()=>l[17]||(l[17]=[(0,o.createTextVNode)(" 終了する ")]))),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model-value","max-width"]))}},M=a(6262);const z=(0,M.A)(D,[["__scopeId","data-v-6246710d"]]);var F=z},7424:function(e,t,a){a.d(t,{i:function(){return g}});var o=a(689),l=a(9923),c=a(2886),i=a(9262),n=a(2542),r=a(7018),s=a(9788),d=a(8184),m=a(3240),u=a(4663),k=a(7664),v=a(4994);const p=(0,v.jB)({color:String,...(0,l.r)(),...(0,i.u)(),...(0,n.X)(),...(0,r.s)(),...(0,s.M)(),...(0,d.S)(),...(0,m.S)(),...(0,u.X)(),...(0,k.yx)()},"VSheet"),g=(0,v.RW)()({name:"VSheet",props:p(),setup(e,t){let{slots:a}=t;const{themeClasses:i}=(0,k.NX)(e),{backgroundColorClasses:u,backgroundColorStyles:p}=(0,c.z6)((0,o.toRef)(e,"color")),{borderClasses:g}=(0,l.M)(e),{dimensionStyles:x}=(0,n.S)(e),{elevationClasses:y}=(0,r.j)(e),{locationStyles:f}=(0,s.z)(e),{positionClasses:h}=(0,d.J)(e),{roundedClasses:w}=(0,m.v)(e);return(0,v.Ci)((()=>(0,o.createVNode)(e.tag,{class:["v-sheet",i.value,u.value,g.value,y.value,h.value,w.value,e.class],style:[p.value,x.value,f.value,e.style]},a))),{}}})},3630:function(e,t,a){a.d(t,{m:function(){return l.m},r:function(){return o.r3}});var o=a(6048),l=a(1781)}}]);
//# sourceMappingURL=490.66ff5332.js.map